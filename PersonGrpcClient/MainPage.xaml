<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
         xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
         x:Class="PersonGrpcClient.MainPage"
         BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}">

    <ScrollView>
        <VerticalStackLayout Spacing="25" Padding="30,0">

            <!-- Título -->
            <Label 
            Text="Person Registration"
            SemanticProperties.HeadingLevel="Level1"
            FontSize="32"
            FontAttributes="Bold"
            HorizontalOptions="Center" 
            Margin="0,20,0,0"/>

            <!-- Status da Conexão -->
            <Label 
            x:Name="ConnectionStatusLabel"
            Text="{Binding ConnectionStatusText}"
            TextColor="{Binding ConnectionStatusColor}"
            HorizontalOptions="Center"
            FontSize="16"/>

            <!-- Formulário -->
            <Frame BorderColor="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
               Padding="20"
               CornerRadius="10"
               HasShadow="True">

                <Grid ColumnDefinitions="*,*" 
                  ColumnSpacing="15" 
                  RowDefinitions="Auto,Auto,Auto,Auto,Auto"
                  RowSpacing="15">

                    <!-- Primeira Coluna -->
                    <VerticalStackLayout Grid.Column="0" Grid.Row="0" Spacing="5">
                        <Label 
                        Text="First Name"
                        FontSize="14"
                        TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                        <Entry 
                        Text="{Binding Name}"
                        Placeholder="Enter first name"
                        ReturnType="Next"/>
                    </VerticalStackLayout>

                    <!-- Segunda Coluna -->
                    <VerticalStackLayout Grid.Column="1" Grid.Row="0" Spacing="5">
                        <Label 
                        Text="Last Name"
                        FontSize="14"
                        TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                        <Entry 
                        Text="{Binding LastName}"
                        Placeholder="Enter last name"
                        ReturnType="Next"/>
                    </VerticalStackLayout>

                    <!-- Primeira Coluna, Segunda Linha -->
                    <!-- Age Entry -->
                    <VerticalStackLayout Grid.Column="0" Grid.Row="1" Spacing="5">
                        <Label 
    Text="Age"
    FontSize="14"
    TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                        <Entry 
    Text="{Binding Age, Converter={StaticResource NullableValueConverter}}"
    Placeholder="Enter age"
    Keyboard="Numeric"
    ReturnType="Next"/>
                    </VerticalStackLayout>

                    <!-- Weight Entry -->
                    <VerticalStackLayout Grid.Column="1" Grid.Row="1" Spacing="5">
                        <Label 
    Text="Weight (kg)"
    FontSize="14"
    TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                        <Entry 
    Text="{Binding Weight, Converter={StaticResource NullableValueConverter}}"
    Placeholder="Enter weight"
    Keyboard="Numeric"
    ReturnType="Done"/>
                    </VerticalStackLayout>

                    <!-- Botão e Loading (Centralizado, ocupando ambas as colunas) -->
                    <VerticalStackLayout Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="2" 
                                   Spacing="10" Margin="0,10,0,0">
                        <Button 
                        Text="Save Person"
                        Command="{Binding SaveCommand}"
                        IsEnabled="{Binding IsNotBusy}"
                        BackgroundColor="Blue"
                        HorizontalOptions="Center"
                        WidthRequest="200"
                        HeightRequest="50"
                        FontAttributes="Bold"/>

                        <ActivityIndicator 
                        IsRunning="{Binding IsBusy}"
                        IsVisible="{Binding IsBusy}"
                        Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}"
                        HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <!-- Lista de Pessoas -->
            <Frame BorderColor="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
               Padding="20"
               CornerRadius="10"
               HasShadow="True">

                <VerticalStackLayout Spacing="10">
                    <Label 
                    Text="Saved Records"
                    FontSize="24"
                    FontAttributes="Bold"
                    HorizontalOptions="Center"/>

                    <CollectionView 
ItemsSource="{Binding SavedPeople}"
EmptyView="No records found"
HeightRequest="300">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Margin="0,5" 
               Padding="15" 
               BorderColor="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
               CornerRadius="8"
               HasShadow="True">

                                    <Grid ColumnDefinitions="*, *" 
                  ColumnSpacing="15">

                                        <!-- Coluna da Esquerda: Dados Pessoais -->
                                        <VerticalStackLayout Grid.Column="0" 
                                   Spacing="8">
                                            <Label Text="Personal Information"
                           FontAttributes="Bold"
                           FontSize="16"
                           Margin="0,0,0,5"/>

                                            <VerticalStackLayout Spacing="4">
                                                <Label Text="{Binding Name, StringFormat='Name: {0}'}" />
                                                <Label Text="{Binding LastName, StringFormat='Last Name: {0}'}" />
                                                <Label Text="{Binding Age, StringFormat='Age: {0}'}" />
                                                <Label Text="{Binding Weight, StringFormat='Weight: {0:F1} kg'}" />
                                            </VerticalStackLayout>
                                        </VerticalStackLayout>

                                        <!-- Coluna da Direita: Status e Sincronização -->
                                        <VerticalStackLayout Grid.Column="1" 
                                   Spacing="8">
                                            <Label Text="Sync Status"
                           FontAttributes="Bold"
                           FontSize="16"
                           Margin="0,0,0,5"/>

                                            <!-- Status Principal -->
                                            <Label Text="{Binding DisplayStatus}"
                           TextColor="{Binding StatusColor}"
                           FontAttributes="Bold"/>

                                            <!-- Detalhes do Status -->
                                            <Label Text="{Binding DetailedStatus}"
                           FontSize="12"/>
                                        </VerticalStackLayout>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    <Button 
                        Text="Clear Local Data"
                        Command="{Binding ClearDataCommand}"
                         WidthRequest="200"
                         HeightRequest="50"
                         FontAttributes="Bold"
                        BackgroundColor="Red"
                        TextColor="White"
                        Margin="0,10,0,0"/>
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>